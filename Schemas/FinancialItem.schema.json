{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "title": "FinancialItem",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "Id": {
      "type": "string",
      "readonly": true,
      "description": "Unique identifier for this item (auto-generated, read-only)."
    },
    "Name": {
      "type": "string",
      "description": "Human-readable name for this item."
    },
    "Description": {
      "type": "string",
      "description": "Optional description of the item's purpose or role."
    },
    "Tags": {
      "description": "List of tags or categories associated with the item.",
      "oneOf": [
        {
          "$ref": "#/definitions/BindingListOfString"
        }
      ]
    },
    "Type": {
      "description": "The classification of the item (e.g., income, liability).",
      "oneOf": [
        {
          "$ref": "#/definitions/ItemType"
        }
      ]
    },
    "IsMainSavingsAccount": {
      "type": "boolean",
      "description": "True if this is the main savings account, false if it is a secondary account."
    },
    "IsLiquidAsset": {
      "type": "boolean",
      "description": "True if this is a liquid asset, false if it is an illiquid asset."
    },
    "Currency": {
      "type": "string",
      "description": "Currency code used for display and reporting (e.g., 'AUD')."
    },
    "EvalOrder": {
      "type": "integer",
      "description": "Lower numbers are evaluated first. Higher numbers are evaluated last.",
      "format": "int32"
    },
    "IncludeInResults": {
      "type": "boolean",
      "description": "If true, this item appears in graphs, CSV output, and data grid. If false, item is hidden from results (but still participates in calculations)."
    },
    "Value": {
      "type": "number",
      "description": "Set to current (start) value of this item. For Debts use negative values",
      "format": "decimal"
    },
    "CashIn": {
      "description": "Money flowing TO the user (income/revenue).\nExamples: Salary, rental income, dividends.\nDeposited to main savings account.",
      "oneOf": [
        {
          "$ref": "#/definitions/AmountFreq"
        }
      ]
    },
    "CashOut": {
      "description": "Money flowing FROM the user (expenses/costs).\nExamples: Rent, loan repayments, property rates.\nDeducted from main savings account.",
      "oneOf": [
        {
          "$ref": "#/definitions/AmountFreq"
        }
      ]
    },
    "Interest": {
      "description": "Interest applied to item Value. Use for assets with loans (e.g., rental property that earns Cash In Flow, incurs CashOut, and also accrues loan interest against Value).",
      "oneOf": [
        {
          "$ref": "#/definitions/AmountFreq"
        }
      ]
    },
    "ShareDetails": {
      "description": "Share-specific details (unit count, price). Only used when Type is Shares.",
      "oneOf": [
        {
          "type": "null"
        },
        {
          "$ref": "#/definitions/ShareDetails"
        }
      ]
    },
    "StartEnabled": {
      "type": "boolean",
      "description": "Initial state when simulation begins. If false, item waits for trigger conditions before activating."
    },
    "DisabledByUser": {
      "type": "boolean",
      "description": "Check to exclude this item from simulation entirely. Overrides all triggers and prevents activation."
    },
    "EnabledBySim": {
      "type": "boolean",
      "readonly": true,
      "description": "Current state in simulation (read-only). Changes based on triggers during sim."
    },
    "StartDate": {
      "type": "string",
      "format": "date"
    },
    "StartDateProxy": {
      "type": "string",
      "description": "Set date in future if you want this item to only be active after the date",
      "format": "date-time"
    },
    "EndDate": {
      "type": "string",
      "format": "date"
    },
    "EndDateProxy": {
      "type": "string",
      "description": "Set date in future if you want this item to auto disable itself at the set date",
      "format": "date-time"
    },
    "Events": {
      "type": "array",
      "description": "Payments initiated from this item to others, only processed if this item is currently active.\nThis Financial Item must have Value > 0 for these to execute.",
      "items": {
        "$ref": "#/definitions/EventItem"
      }
    },
    "SelfTrigger": {
      "description": "Conditions that control whether this item is active. Evaluated each simulation step.",
      "oneOf": [
        {
          "$ref": "#/definitions/TriggerConditions"
        }
      ]
    },
    "LiquidateSelfOnTrigger": {
      "type": "boolean",
      "description": "If true and SelfTrigger conditions are met, liquidate this asset. Transfers all funds to main savings account and disables the asset. Only valid for Asset type items."
    }
  },
  "definitions": {
    "BindingListOfString": {
      "allOf": [
        {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "RaiseListChangedEvents": {
              "type": "boolean"
            },
            "AllowNew": {
              "type": "boolean"
            },
            "AllowEdit": {
              "type": "boolean"
            },
            "AllowRemove": {
              "type": "boolean"
            },
            "SupportsChangeNotificationCore": {
              "type": "boolean"
            },
            "SupportsSearchingCore": {
              "type": "boolean"
            },
            "SupportsSortingCore": {
              "type": "boolean"
            },
            "IsSortedCore": {
              "type": "boolean"
            },
            "SortPropertyCore": {
              "oneOf": [
                {
                  "type": "null"
                },
                {
                  "$ref": "#/definitions/PropertyDescriptor"
                }
              ]
            },
            "SortDirectionCore": {
              "$ref": "#/definitions/ListSortDirection"
            }
          }
        }
      ]
    },
    "PropertyDescriptor": {
      "allOf": [
        {
          "$ref": "#/definitions/MemberDescriptor"
        },
        {
          "type": "object",
          "x-abstract": true,
          "additionalProperties": false,
          "properties": {
            "ComponentType": {
              "type": "string"
            },
            "Converter": {
              "$ref": "#/definitions/TypeConverter"
            },
            "IsLocalizable": {
              "type": "boolean"
            },
            "IsReadOnly": {
              "type": "boolean"
            },
            "SerializationVisibility": {
              "$ref": "#/definitions/DesignerSerializationVisibility"
            },
            "PropertyType": {
              "type": "string"
            },
            "SupportsChangeEvents": {
              "type": "boolean"
            }
          }
        }
      ]
    },
    "TypeConverter": {
      "type": "object",
      "additionalProperties": false
    },
    "DesignerSerializationVisibility": {
      "type": "integer",
      "description": "0 = Hidden\n1 = Visible\n2 = Content",
      "x-enumNames": [
        "Hidden",
        "Visible",
        "Content"
      ],
      "enum": [
        0,
        1,
        2
      ]
    },
    "MemberDescriptor": {
      "type": "object",
      "x-abstract": true,
      "additionalProperties": false,
      "properties": {
        "AttributeArray": {
          "type": [
            "array",
            "null"
          ],
          "items": {
            "$ref": "#/definitions/Attribute"
          }
        },
        "Attributes": {
          "type": "array",
          "items": {}
        },
        "Category": {
          "type": "string"
        },
        "Description": {
          "type": "string"
        },
        "IsBrowsable": {
          "type": "boolean"
        },
        "Name": {
          "type": "string"
        },
        "NameHashCode": {
          "type": "integer",
          "format": "int32"
        },
        "DesignTimeOnly": {
          "type": "boolean"
        },
        "DisplayName": {
          "type": "string"
        }
      }
    },
    "Attribute": {
      "type": "object",
      "x-abstract": true,
      "additionalProperties": false,
      "properties": {
        "TypeId": {}
      }
    },
    "ListSortDirection": {
      "type": "integer",
      "description": "0 = Ascending\n1 = Descending",
      "x-enumNames": [
        "Ascending",
        "Descending"
      ],
      "enum": [
        0,
        1
      ]
    },
    "ItemType": {
      "type": "integer",
      "description": "0 = Income\n1 = Savings\n2 = Asset\n3 = Liability\n4 = Expense\n5 = Loan\n6 = Shares\n7 = CreditCard",
      "x-enumNames": [
        "Income",
        "Savings",
        "Asset",
        "Liability",
        "Expense",
        "Loan",
        "Shares",
        "CreditCard"
      ],
      "enum": [
        0,
        1,
        2,
        3,
        4,
        5,
        6,
        7
      ]
    },
    "AmountFreq": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "Id": {
          "type": "string",
          "readonly": true,
          "description": "Unique identifier for this payment (auto-generated, read-only)."
        },
        "Name": {
          "type": "string",
          "description": "Optional name for this payment (e.g., 'Salary', 'Rent', 'Mortgage Interest')"
        },
        "Enabled": {
          "type": "boolean",
          "description": "Enable or disable this payment/interest calculation"
        },
        "Amount": {
          "type": "number",
          "description": "The value of the income or expense.",
          "format": "decimal"
        },
        "IsPercentage": {
          "type": "boolean",
          "description": "If True Amount is treated as a percentage, if false Amount is a fixed value"
        },
        "PercentageBasis": {
          "description": "Sets if percentage calculations are based on Source or Destination value.\nSource/Self: Calculate percentage of source item value.\nDestination: Calculate percentage of target item value (EventItem only).\nNote: FinancialItem AmountFreqs always use Self/Source (enforced by Sanitize).",
          "oneOf": [
            {
              "$ref": "#/definitions/BasisType"
            }
          ]
        },
        "AnnualRateMonthlyCompounding": {
          "type": "boolean",
          "description": "If true, the interest rate is treated as an annual interest rate that is applied monthly. Schedule is set to Monthly and Is Percentage is set to true."
        },
        "Schedule": {
          "description": "Payment schedule and frequency (Daily, Weekly, Fortnightly, Monthly, Annual)",
          "oneOf": [
            {
              "$ref": "#/definitions/TriggerFrequency"
            }
          ]
        }
      }
    },
    "BasisType": {
      "type": "integer",
      "description": "0 = Source\n1 = Destination\n2 = Self",
      "x-enumNames": [
        "Source",
        "Destination",
        "Self"
      ],
      "enum": [
        0,
        1,
        2
      ]
    },
    "TriggerFrequency": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "Id": {
          "type": "string",
          "readonly": true,
          "description": "Unique identifier for this TriggerFrequency (auto-generated, read-only)."
        },
        "Name": {
          "type": "string",
          "description": "Optional name for this TriggerFrequency"
        },
        "Frequency": {
          "description": "How often this trigger fires: Daily, Weekly, Fortnightly, Monthly, Annual",
          "oneOf": [
            {
              "$ref": "#/definitions/Frequency"
            }
          ]
        },
        "DayOfWeek": {
          "description": "Day of week for Weekly/Fortnightly triggers. Only used if Frequency is Weekly or Fortnightly.",
          "oneOf": [
            {
              "type": "null"
            },
            {
              "$ref": "#/definitions/DayOfWeek"
            }
          ]
        },
        "DayOfMonth": {
          "type": [
            "integer",
            "null"
          ],
          "description": "Day of month for Monthly/Annual triggers (1-31). 31 = last day of month. Only used if Frequency is Monthly or Annual.",
          "format": "int32"
        },
        "MonthOfYear": {
          "description": "Month for Annual triggers. Only used if Frequency is Annual.",
          "oneOf": [
            {
              "type": "null"
            },
            {
              "$ref": "#/definitions/MonthOfYear"
            }
          ]
        },
        "TriggerLimit": {
          "type": "integer",
          "description": "Maximum times this trigger can fire (0 = unlimited, 1 = once, n = max n times)",
          "format": "int32"
        },
        "LastTriggered": {
          "type": [
            "null",
            "string"
          ],
          "readonly": true,
          "description": "Date when this trigger last fired (null = never triggered)",
          "format": "date"
        },
        "TriggerCount": {
          "type": "integer",
          "readonly": true,
          "description": "Number of times this trigger has fired (read-only)",
          "format": "int32"
        }
      }
    },
    "Frequency": {
      "type": "integer",
      "description": "0 = Daily\n1 = Weekly\n2 = Fortnightly\n3 = Monthly\n4 = Annual",
      "x-enumNames": [
        "Daily",
        "Weekly",
        "Fortnightly",
        "Monthly",
        "Annual"
      ],
      "enum": [
        0,
        1,
        2,
        3,
        4
      ]
    },
    "DayOfWeek": {
      "type": "integer",
      "description": "0 = Sunday\n1 = Monday\n2 = Tuesday\n3 = Wednesday\n4 = Thursday\n5 = Friday\n6 = Saturday",
      "x-enumNames": [
        "Sunday",
        "Monday",
        "Tuesday",
        "Wednesday",
        "Thursday",
        "Friday",
        "Saturday"
      ],
      "enum": [
        0,
        1,
        2,
        3,
        4,
        5,
        6
      ]
    },
    "MonthOfYear": {
      "type": "integer",
      "description": "1 = January\n2 = February\n3 = March\n4 = April\n5 = May\n6 = June\n7 = July\n8 = August\n9 = September\n10 = October\n11 = November\n12 = December",
      "x-enumNames": [
        "January",
        "February",
        "March",
        "April",
        "May",
        "June",
        "July",
        "August",
        "September",
        "October",
        "November",
        "December"
      ],
      "enum": [
        1,
        2,
        3,
        4,
        5,
        6,
        7,
        8,
        9,
        10,
        11,
        12
      ]
    },
    "ShareDetails": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "Id": {
          "type": "string",
          "readonly": true,
          "description": "Unique auto-generated identifier."
        },
        "Name": {
          "type": "string",
          "description": "Optional name for this share holding (e.g., 'VAS', 'VDHG')."
        },
        "UnitCount": {
          "type": "number",
          "description": "Total units/shares held. Supports fractional shares.",
          "format": "decimal"
        },
        "UnitPrice": {
          "type": "number",
          "description": "Current market price per share. Updated by Interest (growth) each step.",
          "format": "decimal"
        },
        "TotalCostBase": {
          "type": "number",
          "description": "Total purchase cost for CGT calculations. Currently tracked but not used for MVP.",
          "format": "decimal"
        }
      }
    },
    "EventItem": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "Id": {
          "type": "string",
          "readonly": true,
          "description": "Unique identifier for this payment (auto-generated, read-only)."
        },
        "Name": {
          "type": "string",
          "description": "This item's name"
        },
        "Description": {
          "type": "string",
          "description": "Optional description of the payment or its purpose"
        },
        "Enabled": {
          "type": "boolean",
          "description": "Controls whether this EventItem is enabled"
        },
        "Triggers": {
          "description": "Criteria that must be met for this payment to trigger",
          "oneOf": [
            {
              "$ref": "#/definitions/TriggerConditions"
            }
          ]
        },
        "TargetId": {
          "type": "string",
          "readonly": true,
          "description": "Unique identifier for this payment (auto-generated, read-only)."
        },
        "TargetName": {
          "type": "string",
          "description": "The target payee items name. Click the dropdown to select from all available Financial Items."
        },
        "SetStateOnTrigger": {
          "type": "boolean",
          "description": "When payment triggers, change the target item's EnabledBySim state based on 'Target State Action'"
        },
        "TargetStateOnTrigger": {
          "description": "What to do with target item's state when payment triggers (only if 'Set target state on trigger' is enabled)",
          "oneOf": [
            {
              "$ref": "#/definitions/StateAction"
            }
          ]
        },
        "CashOut": {
          "description": "Push Payment from this item to target",
          "oneOf": [
            {
              "$ref": "#/definitions/AmountFreq"
            }
          ]
        },
        "CashIn": {
          "description": "Receive Payment from target to this item",
          "oneOf": [
            {
              "$ref": "#/definitions/AmountFreq"
            }
          ]
        },
        "Liquidate": {
          "type": "boolean",
          "description": "If true, liquidate the target asset when trigger conditions are met. Transfers all funds to main savings account and disables the target. Only valid if target is an Asset type. Mutually exclusive with Cash In/Out Flow."
        }
      }
    },
    "TriggerConditions": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "Id": {
          "type": "string",
          "readonly": true,
          "description": "Unique identifier for this trigger condition set (auto-generated, read-only)."
        },
        "Name": {
          "type": "string",
          "description": "Optional name for debugging this trigger (e.g., 'Property Purchase Trigger')"
        },
        "TriggerMatchType": {
          "description": "How to combine trigger condition results. All=all must pass, Any=any can pass, None=none should pass.",
          "oneOf": [
            {
              "$ref": "#/definitions/MatchLogic"
            }
          ]
        },
        "TriggerMatchValue": {
          "type": "boolean",
          "description": "Value to compare condition results against for '1.1 - Trigger Match Type'."
        },
        "TagMatchType": {
          "description": "How to combine results from '2.2 - Tag Rules'. All=all rules must pass, Any=any rule can pass, None=no rules should pass.",
          "oneOf": [
            {
              "$ref": "#/definitions/MatchLogic"
            }
          ]
        },
        "MatchValue": {
          "type": "boolean"
        },
        "TagRules": {
          "type": "array",
          "description": "Set of Tagged based Financial Item status checks.\nNo 'Tag Rules' = Trigger ignored.",
          "items": {
            "$ref": "#/definitions/TagConditionals"
          }
        },
        "StartDate": {
          "type": [
            "null",
            "string"
          ],
          "format": "date"
        },
        "StartDateProxy": {
          "type": [
            "null",
            "string"
          ],
          "description": "Trigger condition start date. Item will only be active on or after this date.\nNo Date = Check Disabled",
          "format": "date-time"
        },
        "EndDate": {
          "type": [
            "null",
            "string"
          ],
          "format": "date"
        },
        "EndDateProxy": {
          "type": [
            "null",
            "string"
          ],
          "description": "Trigger condition end date. Item will only be active on or before this date.\nNo Date = Check Disabled",
          "format": "date-time"
        },
        "LiquidAssets": {
          "description": "Trigger when total liquid assets meet threshold criteria.",
          "oneOf": [
            {
              "$ref": "#/definitions/ValueTrigger"
            }
          ]
        },
        "MainSavingsBalance": {
          "description": "Trigger when main savings account balance meets threshold criteria.",
          "oneOf": [
            {
              "$ref": "#/definitions/ValueTrigger"
            }
          ]
        },
        "Age": {
          "description": "Trigger when user's age meets the threshold criteria.",
          "oneOf": [
            {
              "$ref": "#/definitions/ValueTrigger"
            }
          ]
        },
        "MinAge": {
          "type": [
            "integer",
            "null"
          ],
          "format": "int32",
          "x-deprecated": true,
          "x-deprecatedMessage": "Use Age ValueTrigger instead. Will be removed in future version."
        },
        "MaxAge": {
          "type": [
            "integer",
            "null"
          ],
          "format": "int32",
          "x-deprecated": true,
          "x-deprecatedMessage": "Use Age ValueTrigger instead. Will be removed in future version."
        }
      }
    },
    "MatchLogic": {
      "type": "integer",
      "description": "0 = All\n1 = Any\n2 = None",
      "x-enumNames": [
        "All",
        "Any",
        "None"
      ],
      "enum": [
        0,
        1,
        2
      ]
    },
    "TagConditionals": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "Id": {
          "type": "string",
          "readonly": true,
          "description": "Unique identifier for this tag conditional (auto-generated, read-only)."
        },
        "Name": {
          "type": "string",
          "description": "Human-readable name for debugging this tag conditional (e.g., 'Requires Active Property')"
        },
        "Enabled": {
          "type": "boolean",
          "description": "Whether this tag conditional is active and should be evaluated. If false, this conditional is skipped."
        },
        "Description": {
          "type": "string",
          "description": "Optional description of this tag conditional's purpose or role."
        },
        "Tags": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "MatchType": {
          "description": "All = all items must match, Any = at least one item must match, None = no items should match",
          "oneOf": [
            {
              "$ref": "#/definitions/MatchLogic"
            }
          ]
        },
        "MatchValue": {
          "type": "boolean",
          "description": "true = items must be enabled, false = items must be disabled"
        }
      }
    },
    "ValueTrigger": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "Id": {
          "type": "string",
          "readonly": true,
          "description": "Unique identifier for this trigger (auto-generated, read-only)."
        },
        "Name": {
          "type": "string",
          "description": "Optional name for this trigger (e.g., 'Emergency Fund Threshold')"
        },
        "Enabled": {
          "type": "boolean",
          "description": "Enable or disable the entire trigger"
        },
        "Operator": {
          "description": "Comparison operator to use: GreaterThan, GreaterThanOrEqual, LessThan, LessThanOrEqual, Equal, NotEqual",
          "oneOf": [
            {
              "$ref": "#/definitions/Comparator"
            }
          ]
        },
        "ComparisonValue": {
          "type": "number",
          "description": "The value to compare against using the selected operator.",
          "format": "decimal"
        },
        "MinEnabled": {
          "type": [
            "boolean",
            "null"
          ],
          "x-deprecated": true,
          "x-deprecatedMessage": "Use Operator and ComparisonValue instead. Will be removed in future version."
        },
        "MinValue": {
          "type": [
            "null",
            "number"
          ],
          "format": "decimal",
          "x-deprecated": true,
          "x-deprecatedMessage": "Use Operator and ComparisonValue instead. Will be removed in future version."
        },
        "MaxEnabled": {
          "type": [
            "boolean",
            "null"
          ],
          "x-deprecated": true,
          "x-deprecatedMessage": "Use Operator and ComparisonValue instead. Will be removed in future version."
        },
        "MaxValue": {
          "type": [
            "null",
            "number"
          ],
          "format": "decimal",
          "x-deprecated": true,
          "x-deprecatedMessage": "Use Operator and ComparisonValue instead. Will be removed in future version."
        },
        "TriggerLimit": {
          "type": "integer",
          "description": "The maximum number of times the trigger can be activated. 0 = unlimited"
        },
        "TriggerCount": {
          "type": "integer",
          "description": "The number of times the trigger has been activated",
          "format": "int32"
        },
        "LastTriggerDate": {
          "type": "string",
          "description": "The date when the trigger was last activated",
          "format": "date"
        }
      }
    },
    "Comparator": {
      "type": "integer",
      "description": "0 = Equal\n1 = NotEqual\n2 = GreaterThan\n3 = GreaterThanOrEqual\n4 = LessThan\n5 = LessThanOrEqual",
      "x-enumNames": [
        "Equal",
        "NotEqual",
        "GreaterThan",
        "GreaterThanOrEqual",
        "LessThan",
        "LessThanOrEqual"
      ],
      "enum": [
        0,
        1,
        2,
        3,
        4,
        5
      ]
    },
    "StateAction": {
      "type": "integer",
      "description": "0 = Enable\n1 = Disable\n2 = Toggle",
      "x-enumNames": [
        "Enable",
        "Disable",
        "Toggle"
      ],
      "enum": [
        0,
        1,
        2
      ]
    }
  }
}